@inherits LayoutComponentBase
@using MudBlazor
@inject NavigationManager Nav
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@inject IJSRuntime JS
@inject HttpClient Http
@using MudBlazor.Utilities

<MudThemeProvider />
<MudPopoverProvider />
<MudSnackbarProvider Style="z-index: 2000; background-color: white;" />

<MudLayout>
    <!-- TOP BAR WITH LOGO -->
	<MudAppBar Elevation="0" Style="background-color:#154ba3; height:80px; z-index:600;">
        <MudImage Src="images/Female_Logo.jpg" Alt="Turkcell Logo" Width="100" Class="mt-4" />
        <MudSpacer />
        <MudText Class="mr-4"
                 Style="color:white; font-weight:bold; cursor:pointer; display:inline; margin-top:50px"
                 @onclick="Logout">
            Logout
        </MudText>
    </MudAppBar>
    <!-- Sidebar Drawer -->
    <MudDrawer Open="true"
               Variant="DrawerVariant.Persistent"
               Anchor="Anchor.Start"
               Elevation="1"
               ClipMode="DrawerClipMode.Always"
               Class="pa-2"
               Style="margin-top:10px; background-color:#E0E0E0; width:200px; z-index:500;">
        <MudNavMenu>
            <!-- Section: İşlem Listesi -->
            <MudText Class="ml-6 mt-6 mb-6" Style="color:black; font-weight:bold;">İşlem Listesi</MudText>
            <!-- Hesap İşlemleri -->
            <MudText Class="ml-6 mt-2 mb-0" Style="color:black; cursor:pointer; display:block;" @onclick="ToggleHesap">
                Hesap İşlemleri
            </MudText>
            <MudCollapse Expanded="@_hesapExpanded">
                <MudText Class="ml-10 mt-2 mb-2" Style="color:black; cursor:pointer; display:block;" @onclick="@(() => Nav.NavigateTo("/open-account"))">
                    Hesap Açımı
                </MudText>
                <MudText Class="ml-10 mt-2 mb-0" Style="color:black; cursor:pointer; display:block;" @onclick="@(() => Nav.NavigateTo("/close-account"))">
                    Hesap Kapatma
                </MudText>
            </MudCollapse>
            <!-- Para Transferi -->
            <MudText Class="ml-6 mt-4 mb-0" Style="color:black; cursor:pointer; display:block;" @onclick="TogglePara">
                Para Transferi
            </MudText>
            <MudCollapse Expanded="@_paraExpanded">
                <MudText Class="ml-10 mt-2 mb-2" Style="color:black; cursor:pointer; display:block;" @onclick="@(() => Nav.NavigateTo("/havale"))">
                    Havale İşlemleri
                </MudText>
                <MudText Class="ml-10 mt-2 mb-2" Style="color:black; cursor:pointer; display:block;" @onclick="@(() => Nav.NavigateTo("/eft"))">
                    EFT İşlemleri
                </MudText>
            </MudCollapse>
            <!-- Kredi Başvurusu -->
            <MudText Class="ml-6 mt-4 mb-4" Style="color:black; cursor:pointer; display:block;" @onclick="@(() => 
                                            { ToggleAll(); Nav.NavigateTo("/credit-apply"); })">
                Kredi Başvurusu
            </MudText>
            <!-- Bilgi Güncelleme -->
            <MudText Class="ml-6 mt-4 mb-4" Style="color:black; cursor:pointer; display:block;" @onclick="@(() => 
                                            { ToggleAll(); Nav.NavigateTo("/update"); })">
                Bilgi Güncelleme
            </MudText>
            <!-- Ödeme İşlemleri -->
            <MudText Class="ml-6 mt-4 mb-4" Style="color:black; cursor:pointer; display:block;" @onclick="@(() =>
                                            { ToggleAll(); Nav.NavigateTo("/payment"); })"> 
                Ödeme İşlemleri
            </MudText>

            <MudDivider Class="my-2" />
            <!-- Main navigation -->
            <MudNavLink Href="/home" Icon="@Icons.Material.Filled.Dashboard" Match="NavLinkMatch.All" Style="color:black; margin-top:10px;">
                Ana Sayfam
            </MudNavLink>
            <MudNavLink Href="/settings" Icon="@Icons.Material.Filled.Settings" Match="NavLinkMatch.All" Style="color:black;">
                Ayarlarım
            </MudNavLink>
        </MudNavMenu>
    </MudDrawer>
         <!-- Main Content -->
        <MudMainContent Class="p-4" Style="margin-top:60px;">
        @Body
         </MudMainContent>
</MudLayout>

@code {
    private bool _hesapExpanded;
    private bool _paraExpanded;

    private void ToggleHesap()
    {
        _hesapExpanded = !_hesapExpanded;
        _paraExpanded = false;
        Console.WriteLine("CLICKED");
    }
    private void TogglePara()
    {
        _paraExpanded = !_paraExpanded;
        _hesapExpanded = false;
        Console.WriteLine("CLICKED");
    }
    private void ToggleAll()
    {
        _paraExpanded = false;
        _hesapExpanded = false;
    }
    private async Task Logout()
    {
        await JS.InvokeVoidAsync("sessionStorage.removeItem", "authToken");
        Http.DefaultRequestHeaders.Authorization = null;
        Nav.NavigateTo("/login", true);
    }
    }


